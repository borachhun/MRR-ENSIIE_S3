# remove CHL 2-18, 5days and year (7:25)
cv_elastic_net <- cv.glmnet(x=as.matrix(bats[, -(7:25)]), y=bats[,(6+i)], alpha=a/10)
# 7 = always target
reg_elastic_net <- glmnet(x=as.matrix(train_data_CHLi[,-7]), y=train_data_CHLi[,7], alpha=a/10, lambda=cv_elastic_net$lambda.min)
elastic_net_predict <- 10^predict(reg_elastic_net, newx=as.matrix(test_data_CHLi[,-7]))
sub_rmse_elastic_net <- c(sub_rmse_elastic_net, sqrt(sum((CHLi_sample - elastic_net_predict)^2) / length(CHLi_sample)))
sub_r_squared_elastic_net <- c(sub_r_squared_elastic_net, r_squared(CHLi_sample, elastic_net_predict))
}
min_error_index <- which.min(sub_rmse_elastic_net)
rmse_bats_elastic_net <- c(rmse_bats_elastic_net, sub_rmse_elastic_net[min_error_index])
r_squared_bats_elastic_net <- c(r_squared_bats_elastic_net, sub_r_squared_elastic_net[min_error_index])
}
plot_rmse_bats <- grid.arrange(
my_plot(rmse_bats_linear, "RMSE", "Linear"),
my_plot(rmse_bats_forward, "RMSE", "Forward"),
my_plot(rmse_bats_ridge, "RMSE", "Ridge"),
my_plot(rmse_bats_lasso, "RMSE", "Lasso"),
my_plot(rmse_bats_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse_bats.png", plot=plot_rmse_bats, height=2, width=15)
plot_r_squared_bats <- grid.arrange(
my_plot(r_squared_bats_linear, "R-squared", "Linear"),
my_plot(r_squared_bats_forward, "R-squared", "Forward"),
my_plot(r_squared_bats_ridge, "R-squared", "Ridge"),
my_plot(r_squared_bats_lasso, "R-squared", "Lasso"),
my_plot(r_squared_bats_elastic_net, "R-squared", "Elastic net"),
nrow=1)
ggsave("plot_r_squared_bats.png", plot=plot_r_squared_bats, height=2, width=12)
bats_with_prev <- bats[order(bats$year),]
bats_with_prev$`Prev SSH` <- shift(bats_with_prev$`SSH`)
bats_with_prev$`Prev CC` <- shift(bats_with_prev$`CC`)
bats_with_prev$`Prev WS` <- shift(bats_with_prev$`WS`)
bats_with_prev$`Prev SR` <- shift(bats_with_prev$`SR`)
bats_with_prev$`Prev THERM 1` <- shift(bats_with_prev$`THERM 1`)
bats_with_prev$`Prev CHL 1` <- shift(bats_with_prev$`CHL 1`)
# remove first line (NA)
bats_with_prev <- bats_with_prev[-1,]
colnames(bats_with_prev)
# remove 5days and year (24,25)
bats_with_prev_train_data <- bats_with_prev[bats_with_prev$year %in% c(subset_year[[1]], subset_year[[2]], subset_year[[3]]), -c(24,25)]
bats_with_prev_test_data <- bats_with_prev[bats_with_prev$year %in% subset_year[[4]], -c(24,25)]
bats_with_prev_validate_data <- bats_with_prev[bats_with_prev$year %in% subset_year[[5]], -c(24,25)]
colnames(bats_with_prev_train_data)
rmse_bats_prev_linear <- c()
rmse_bats_prev_forward <- c()
rmse_bats_prev_ridge <- c()
rmse_bats_prev_lasso <- c()
rmse_bats_prev_elastic_net <- c()
r_squared_bats_prev_linear <- c()
r_squared_bats_prev_forward <- c()
r_squared_bats_prev_ridge <- c()
r_squared_bats_prev_lasso <- c()
r_squared_bats_prev_elastic_net <- c()
# loop for CHL 2-18
for (i in 1:17) {
# 7:23 = CHL 2-18
train_data_CHLi <- bats_with_prev_train_data[, -(c(7:23)[-i])]
test_data_CHLi <- bats_with_prev_test_data[, -(c(7:23)[-i])]
# 7 = always target CHL i
CHLi_sample <- 10^test_data_CHLi[, 7]
# === LINEAR ===
formula <- as.formula(paste("`CHL ", i+1, "` ~ .", sep=""))
reg_linear <- lm(formula, data=train_data_CHLi)
linear_predict <- 10^predict(reg_linear, newdata=test_data_CHLi)
rmse_bats_prev_linear <- c(rmse_bats_prev_linear, sqrt(sum((CHLi_sample - linear_predict)^2) / length(CHLi_sample)))
r_squared_bats_prev_linear <- c(r_squared_bats_prev_linear, r_squared(CHLi_sample, linear_predict))
# === FORWARD ===
forward_formula <- as.formula(paste("`CHL ", i+1, "` ~ 1", sep=""))
reg_forward <- step(lm(forward_formula, data=train_data_CHLi), list(upper=reg_linear), direction="forward", trace=0)
forward_predict <- 10^predict(reg_forward, newdata=test_data_CHLi)
rmse_bats_prev_forward <- c(rmse_bats_prev_forward, sqrt(sum((CHLi_sample - forward_predict)^2) / length(CHLi_sample)))
r_squared_bats_prev_forward <- c(r_squared_bats_prev_forward, r_squared(CHLi_sample, forward_predict))
# === RIDGE ===
# remove CHL 2-18, 5days and year (7:25)
cv_ridge <- cv.glmnet(x=as.matrix(bats_with_prev[, -(7:25)]), y=bats_with_prev[,(6+i)], alpha=0)
# 7 = always target
reg_ridge <- glmnet(x=as.matrix(train_data_CHLi[,-7]), y=train_data_CHLi[,7], alpha=0, lambda=cv_ridge$lambda.min)
ridge_predict <- 10^predict(reg_ridge, newx=as.matrix(test_data_CHLi[,-7]))
rmse_bats_prev_ridge <- c(rmse_bats_prev_ridge, sqrt(sum((CHLi_sample - ridge_predict)^2) / length(CHLi_sample)))
r_squared_bats_prev_ridge <- c(r_squared_bats_prev_ridge, r_squared(CHLi_sample, ridge_predict))
# === LASSO ===
# remove CHL 2-18, 5days and year (7:25)
cv_lasso <- cv.glmnet(x=as.matrix(bats_with_prev[, -(7:25)]), y=bats_with_prev[,(6+i)], alpha=1)
# 7 = always target
reg_lasso <- glmnet(x=as.matrix(train_data_CHLi[,-7]), y=train_data_CHLi[,7], alpha=1, lambda=cv_lasso$lambda.min)
lasso_predict <- 10^predict(reg_lasso, newx=as.matrix(test_data_CHLi[,-7]))
rmse_bats_prev_lasso <- c(rmse_bats_prev_lasso, sqrt(sum((CHLi_sample - lasso_predict)^2) / length(CHLi_sample)))
r_squared_bats_prev_lasso <- c(r_squared_bats_prev_lasso, r_squared(CHLi_sample, lasso_predict))
# === ELASTIC NET ===
sub_rmse_elastic_net <- c()
sub_r_squared_elastic_net <- c()
for (a in 0:10) {
# remove CHL 2-18, 5days and year (7:25)
cv_elastic_net <- cv.glmnet(x=as.matrix(bats_with_prev[, -(7:25)]), y=bats_with_prev[,(6+i)], alpha=a/10)
# 7 = always target
reg_elastic_net <- glmnet(x=as.matrix(train_data_CHLi[,-7]), y=train_data_CHLi[,7], alpha=a/10, lambda=cv_elastic_net$lambda.min)
elastic_net_predict <- 10^predict(reg_elastic_net, newx=as.matrix(test_data_CHLi[,-7]))
sub_rmse_elastic_net <- c(sub_rmse_elastic_net, sqrt(sum((CHLi_sample - elastic_net_predict)^2) / length(CHLi_sample)))
sub_r_squared_elastic_net <- c(sub_r_squared_elastic_net, r_squared(CHLi_sample, elastic_net_predict))
}
min_error_index <- which.min(sub_rmse_elastic_net)
rmse_bats_prev_elastic_net <- c(rmse_bats_prev_elastic_net, sub_rmse_elastic_net[min_error_index])
r_squared_bats_prev_elastic_net <- c(r_squared_bats_prev_elastic_net, sub_r_squared_elastic_net[min_error_index])
}
plot_rmse_bats_prev <- grid.arrange(
my_plot(rmse_bats_prev_linear, "RMSE", "Linear"),
my_plot(rmse_bats_prev_forward, "RMSE", "Forward"),
my_plot(rmse_bats_prev_ridge, "RMSE", "Ridge"),
my_plot(rmse_bats_prev_lasso, "RMSE", "Lasso"),
my_plot(rmse_bats_prev_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse_bats_prev.png", plot=plot_rmse_bats_prev, height=2, width=12)
plot_r_squared_bat_prev <- grid.arrange(
my_plot(r_squared_bats_prev_linear, "R-squared", "Linear"),
my_plot(r_squared_bats_prev_forward, "R-squared", "Forward"),
my_plot(r_squared_bats_prev_ridge, "R-squared", "Ridge"),
my_plot(r_squared_bats_prev_lasso, "R-squared", "Lasso"),
my_plot(r_squared_bats_prev_elastic_net, "R-squared", "Elastic net"),
nrow=1)
ggsave("plot_r_squared_bat_prev.png", plot=plot_r_squared_bat_prev, height=2, width=12)
# remove lat,long (26,27)
nine_locations <- df[(round(df$latitude)==32 & round(df$longitude)==-64), -c(26,27)]
i <- 1
for (lat in unique(round(df$latitude))) {
for (long in unique(round(df$longitude))) {
if (!(lat==32 & long==-64)) {
# remove CHL 2-18, 5days, year, lat, long (7:27)
tmp <- df[(round(df$latitude)==lat & round(df$longitude)==long), -(7:27)]
colnames(tmp) <- paste(colnames(tmp), i)
nine_locations <- cbind(nine_locations, tmp)
i <- i + 1
}
}
}
# convert date to sin and cos
nine_locations$`sin5days` <- sin(2*pi* nine_locations$`5days` /73)
nine_locations$`cos5days` <- cos(2*pi* nine_locations$`5days` /73)
# remove 5days (24)
nine_locations <- nine_locations[, -24]
colnames(nine_locations)
# remove year (24)
train_data <- nine_locations[nine_locations$year %in% c(subset_year[[1]], subset_year[[2]], subset_year[[3]]), -24]
test_data <- nine_locations[nine_locations$year %in% subset_year[[4]], -24]
validate_data <- nine_locations[nine_locations$year %in% subset_year[[5]], -24]
colnames(train_data)
rmse_linear <- c()
rmse_forward <- c()
rmse_ridge <- c()
rmse_lasso <- c()
rmse_elastic_net <- c()
r_squared_linear <- c()
r_squared_forward <- c()
r_squared_ridge <- c()
r_squared_lasso <- c()
r_squared_elastic_net <- c()
# loop for CHL 2-18
for (i in 1:17) {
# 7:23 = CHL 2-18
train_data_CHLi <- train_data[, -(c(7:23)[-i])]
test_data_CHLi <- test_data[, -(c(7:23)[-i])]
# 7 = always target CHL i
CHLi_sample <- 10^test_data_CHLi[, 7]
# === LINEAR ===
formula <- as.formula(paste("`CHL ", i+1, "` ~ .", sep=""))
reg_linear <- lm(formula, data=train_data_CHLi)
linear_predict <- 10^predict(reg_linear, newdata=test_data_CHLi)
rmse_linear <- c(rmse_linear, sqrt(sum((CHLi_sample - linear_predict)^2) / length(CHLi_sample)))
r_squared_linear <- c(r_squared_linear, r_squared(CHLi_sample, linear_predict))
# === FORWARD ===
forward_formula <- as.formula(paste("`CHL ", i+1, "` ~ 1", sep=""))
reg_forward <- step(lm(forward_formula, data=train_data_CHLi), list(upper=reg_linear), direction="forward", trace=0)
forward_predict <- 10^predict(reg_forward, newdata=test_data_CHLi)
rmse_forward <- c(rmse_forward, sqrt(sum((CHLi_sample - forward_predict)^2) / length(CHLi_sample)))
r_squared_forward <- c(r_squared_forward, r_squared(CHLi_sample, forward_predict))
# === RIDGE ===
# remove CHL 2-18 and year (7:24)
cv_ridge <- cv.glmnet(x=as.matrix(nine_locations[, -(7:24)]), y=nine_locations[,(6+i)], alpha=0)
# 7 = always target
reg_ridge <- glmnet(x=as.matrix(train_data_CHLi[,-7]), y=train_data_CHLi[,7], alpha=0, lambda=cv_ridge$lambda.min)
ridge_predict <- 10^predict(reg_ridge, newx=as.matrix(test_data_CHLi[,-7]))
rmse_ridge <- c(rmse_ridge, sqrt(sum((CHLi_sample - ridge_predict)^2) / length(CHLi_sample)))
r_squared_ridge <- c(r_squared_ridge, r_squared(CHLi_sample, ridge_predict))
# === LASSO ===
# remove CHL 2-18 and year (7:24)
cv_lasso <- cv.glmnet(x=as.matrix(nine_locations[, -(7:24)]), y=nine_locations[,(6+i)], alpha=1)
# 7 = always target
reg_lasso <- glmnet(x=as.matrix(train_data_CHLi[,-7]), y=train_data_CHLi[,7], alpha=1, lambda=cv_lasso$lambda.min)
lasso_predict <- 10^predict(reg_lasso, newx=as.matrix(test_data_CHLi[,-7]))
rmse_lasso <- c(rmse_lasso, sqrt(sum((CHLi_sample - lasso_predict)^2) / length(CHLi_sample)))
r_squared_lasso <- c(r_squared_lasso, r_squared(CHLi_sample, lasso_predict))
# === ELASTIC NET ===
sub_rmse_elastic_net <- c()
sub_r_squared_elastic_net <- c()
for (a in 0:10) {
# remove CHL 2-18, 5days and year (7:25)
cv_elastic_net <- cv.glmnet(x=as.matrix(nine_locations[, -(7:24)]), y=nine_locations[,(6+i)], alpha=a/10)
# 7 = always target
reg_elastic_net <- glmnet(x=as.matrix(train_data_CHLi[,-7]), y=train_data_CHLi[,7], alpha=a/10, lambda=cv_elastic_net$lambda.min)
elastic_net_predict <- 10^predict(reg_elastic_net, newx=as.matrix(test_data_CHLi[,-7]))
sub_rmse_elastic_net <- c(sub_rmse_elastic_net, sqrt(sum((CHLi_sample - elastic_net_predict)^2) / length(CHLi_sample)))
sub_r_squared_elastic_net <- c(sub_r_squared_elastic_net, r_squared(CHLi_sample, elastic_net_predict))
}
min_error_index <- which.min(sub_rmse_elastic_net)
rmse_elastic_net <- c(rmse_elastic_net, sub_rmse_elastic_net[min_error_index])
r_squared_elastic_net <- c(r_squared_elastic_net, sub_r_squared_elastic_net[min_error_index])
}
plot_rmse <- grid.arrange(
my_plot(rmse_linear, "RMSE", "Linear"),
my_plot(rmse_forward, "RMSE", "Forward"),
my_plot(rmse_ridge, "RMSE", "Ridge"),
my_plot(rmse_lasso, "RMSE", "Lasso"),
my_plot(rmse_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse.png", plot=plot_rmse, height=2, width=12)
plot_r_squared <- grid.arrange(
my_plot(r_squared_linear, "R-squared", "Linear"),
my_plot(r_squared_forward, "R-squared", "Forward"),
my_plot(r_squared_ridge, "R-squared", "Ridge"),
my_plot(r_squared_lasso, "R-squared", "Lasso"),
my_plot(r_squared_elastic_net, "R-squared", "Elastic net"),
nrow=1)
ggsave("plot_r_squared.png", plot=plot_r_squared, height=2, width=12)
save.image("~/MRR-ENSIIE_S3/project/mrr_proj_Ocean/data_for_A4_2.RData")
max(c(rmse_bats_linear, rmse_bats_forward, rmse_bats_ridge, rmse_bats_lasso, rmse_bats_elastic_net, rmse_bats_prev_linear, rmse_bats_prev_forward, rmse_bats_prev_ridge, rmse_bats_prev_lasso, rmse_bats_prev_elastic_net, rmse_linear, rmse_forward, rmse_ridge, rmse_lasso, rmse_elastic_net))
library(R.matlab)
library(data.table)
library(glmnet)
library(ggplot2)
library(gridExtra)
r_squared <- function(Y, Y_predict) {
tss <- sum( (Y-mean(Y))^2 )
rss <- sum( (Y-Y_predict)^2 )
return(1-(rss/tss))
}
my_plot <- function(perf_data, perf_type, method) {
res <- ggplot(
data.frame(x_df = 2:18, y_df = perf_data),
aes(x = x_df, y = y_df)
) + ggtitle(method) + xlab("CHL") + ylab(perf_type) + theme(plot.title=element_text(size=15, face="bold"))
if (perf_type == "RMSE") {
res <- res + geom_point(size=2, color="darkorange1") + ylim(0,0.18)
}
else {
res <- res + geom_point(size=2, color="darkcyan") + ylim(0,1)
}
return(res)
}
plot_rmse_bats <- grid.arrange(
my_plot(rmse_bats_linear, "RMSE", "Linear"),
my_plot(rmse_bats_forward, "RMSE", "Forward"),
my_plot(rmse_bats_ridge, "RMSE", "Ridge"),
my_plot(rmse_bats_lasso, "RMSE", "Lasso"),
my_plot(rmse_bats_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse_bats.png", plot=plot_rmse_bats, height=2, width=15)
plot_rmse_bats_prev <- grid.arrange(
my_plot(rmse_bats_prev_linear, "RMSE", "Linear"),
my_plot(rmse_bats_prev_forward, "RMSE", "Forward"),
my_plot(rmse_bats_prev_ridge, "RMSE", "Ridge"),
my_plot(rmse_bats_prev_lasso, "RMSE", "Lasso"),
my_plot(rmse_bats_prev_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse_bats_prev.png", plot=plot_rmse_bats_prev, height=2, width=12)
plot_rmse <- grid.arrange(
my_plot(rmse_linear, "RMSE", "Linear"),
my_plot(rmse_forward, "RMSE", "Forward"),
my_plot(rmse_ridge, "RMSE", "Ridge"),
my_plot(rmse_lasso, "RMSE", "Lasso"),
my_plot(rmse_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse.png", plot=plot_rmse, height=2, width=12)
plot_rmse_bats <- grid.arrange(
my_plot(rmse_bats_linear, "RMSE", "Linear"),
my_plot(rmse_bats_forward, "RMSE", "Forward"),
my_plot(rmse_bats_ridge, "RMSE", "Ridge"),
my_plot(rmse_bats_lasso, "RMSE", "Lasso"),
my_plot(rmse_bats_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse_bats.png", plot=plot_rmse_bats, height=2, width=15)
plot_r_squared_bats <- grid.arrange(
my_plot(r_squared_bats_linear, "R-squared", "Linear"),
my_plot(r_squared_bats_forward, "R-squared", "Forward"),
my_plot(r_squared_bats_ridge, "R-squared", "Ridge"),
my_plot(r_squared_bats_lasso, "R-squared", "Lasso"),
my_plot(r_squared_bats_elastic_net, "R-squared", "Elastic net"),
nrow=1)
ggsave("plot_r_squared_bats.png", plot=plot_r_squared_bats, height=2, width=15)
plot_rmse_bats_prev <- grid.arrange(
my_plot(rmse_bats_prev_linear, "RMSE", "Linear"),
my_plot(rmse_bats_prev_forward, "RMSE", "Forward"),
my_plot(rmse_bats_prev_ridge, "RMSE", "Ridge"),
my_plot(rmse_bats_prev_lasso, "RMSE", "Lasso"),
my_plot(rmse_bats_prev_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse_bats_prev.png", plot=plot_rmse_bats_prev, height=2, width=15)
plot_r_squared_bat_prev <- grid.arrange(
my_plot(r_squared_bats_prev_linear, "R-squared", "Linear"),
my_plot(r_squared_bats_prev_forward, "R-squared", "Forward"),
my_plot(r_squared_bats_prev_ridge, "R-squared", "Ridge"),
my_plot(r_squared_bats_prev_lasso, "R-squared", "Lasso"),
my_plot(r_squared_bats_prev_elastic_net, "R-squared", "Elastic net"),
nrow=1)
ggsave("plot_r_squared_bat_prev.png", plot=plot_r_squared_bat_prev, height=2, width=15)
plot_rmse <- grid.arrange(
my_plot(rmse_linear, "RMSE", "Linear"),
my_plot(rmse_forward, "RMSE", "Forward"),
my_plot(rmse_ridge, "RMSE", "Ridge"),
my_plot(rmse_lasso, "RMSE", "Lasso"),
my_plot(rmse_elastic_net, "RMSE", "Elastic net"),
nrow=1)
ggsave("plot_rmse.png", plot=plot_rmse, height=2, width=15)
plot_r_squared <- grid.arrange(
my_plot(r_squared_linear, "R-squared", "Linear"),
my_plot(r_squared_forward, "R-squared", "Forward"),
my_plot(r_squared_ridge, "R-squared", "Ridge"),
my_plot(r_squared_lasso, "R-squared", "Lasso"),
my_plot(r_squared_elastic_net, "R-squared", "Elastic net"),
nrow=1)
ggsave("plot_r_squared.png", plot=plot_r_squared, height=2, width=15)
length(rmse_bats_linear)
mean(rmse_bats_linear)
max(rmse_bats_linear)
min(rmse_bats_linear)
mean(rmse_bats_linear)
mean(rmse_bats_forward)
mean(rmse_bats_ridge)
mean(rmse_bats_lasso)
mean(rmse_bats_elastic_net)
mean(r_squared_bats_linear)
mean(r_squared_bats_forward)
mean(r_squared_bats_ridge)
mean(r_squared_bats_lasso)
mean(r_squared_bats_elastic_net)
mean(rmse_linear)
mean(rmse_forward)
mean(rmse_ridge)
mean(rmse_lasso)
mean(rmse_elastic_net)
mean(r_squared_linear)
mean(r_squared_forward)
mean(r_squared_ridge)
mean(r_squared_lasso)
mean(r_squared_elastic_net)
mean(rmse_bats_prev_linear)
mean(rmse_bats_prev_forward)
mean(rmse_bats_prev_ridge)
mean(rmse_bats_prev_lasso)
mean(rmse_bats_prev_elastic_net)
mean(r_squared_bats_prev_linear)
mean(r_squared_bats_prev_forward)
mean(r_squared_bats_prev_ridge)
mean(r_squared_bats_prev_lasso)
mean(r_squared_bats_prev_elastic_net)
length(r_squared_bats_prev_elastic_net)
d <- data.frame(c1=c(1,2,3), c2=c(4,5,6))
d
d$c1
d[2,]
as.numeric(d[2,])
?expand.grid
as.numeric(d[1:3,])
?sapply
sapply(1:3, function(row) as.numeric(d[row,]))
expand.grid(depth=1:18, `5days`=1:73)
c(sapply(1:3, function(row) as.numeric(d[row,])))
library(R.matlab)
library(data.table)
library(glmnet)
library(ggplot2)
library(gridExtra)
r_squared <- function(Y, Y_predict) {
tss <- sum( (Y-mean(Y))^2 )
rss <- sum( (Y-Y_predict)^2 )
return(1-(rss/tss))
}
my_plot <- function(perf_data, perf_type, method) {
res <- ggplot(
data.frame(x_df = 2:18, y_df = perf_data),
aes(x = x_df, y = y_df)
) + ggtitle(method) + xlab("CHL") + ylab(perf_type) + theme(plot.title=element_text(size=15, face="bold"))
if (perf_type == "RMSE") {
res <- res + geom_point(size=2, color="darkorange1") + ylim(0,0.18)
}
else {
res <- res + geom_point(size=2, color="darkcyan") + ylim(0,1)
}
return(res)
}
mat_data <- readMat("VectLB19922008.mat")
df <- as.data.frame(mat_data$Vect)
# add column names
colnames(df) <- unlist(mat_data$labels)
# convert all CHL i to log10 scale
df[, 23:40] <- log10(df[, 23:40])
# remove THERM 2 - THERM 18
df <- df[, -(6:22)]
colnames(df)
min(df[,6:23])
max(df[,6:23])
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
return(
ggplot(plot_data,
aes(`5 days`=plot_data$`5days`, `Depth level`=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(0,1.5,0.25)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title))
}
CHL_heat_map(df[df$year=1992,6:23], 1992)
CHL_heat_map(df[df$year==1992,6:23], 1992)
sapply(1:nrow(df), function(row) as.numeric(CHL_data[row,]))
sapply(1:nrow(df), function(row) as.numeric(df[row,]))
dim(sapply(1:nrow(df), function(row) as.numeric(df[row,])))
dim(c(sapply(1:nrow(df), function(row) as.numeric(df[row,]))))
m <- matrix(c(1,2,3,4,5,6,7,8), ncol=2)
m
as.numeric(m)
?as.vector
?as.numeric
as.numeric(m, byrow=TRUE)
as.numeric(m, byrow=FALSE)
as.numeric(t(m))
as.matrix(df)
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- as.numeric(t(as.matrix(CHL_data)))
return(
ggplot(plot_data, aes(`5 days`=plot_data$`5days`, `Depth level`=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(0,1.5,0.25)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title))
}
CHL_heat_map(df[df$year==1992,6:23], 1992)
dim(CHL_heat_map(df[df$year==1992,6:23], 1992))
dim(df[df$year==1992,6:23])
CHL_heat_map(df[(df$year==1992 & round(df$latitude)==32 & round(df$latitude)==-64),6:23], 1992)
bats <- df[(df$latitude>=31) & (df$latitude<=33) & (df$longitude<=-63) & (df$longitude>=-65), ]
# remove lat and long (26,27)
bats <- bats[, -c(26,27)]
# convert date to sin and cos
bats$`sin5days` <- sin(2*pi* bats$`5days` /73)
bats$`cos5days` <- cos(2*pi* bats$`5days` /73)
colnames(bats)
CHL_heat_map(bats[bats$year==1992,6:23], 1992)
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
#return(plot_data)
return(ggplot(plot_data, aes(`5 days`=plot_data$`5days`, `Depth level`=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(0,1.5,0.25)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title))
}
CHL_heat_map(bats[bats$year==1992,6:23], 1992)
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
#return(plot_data)
return(ggplot(plot_data, aes(x=plot_data$`5days`, y=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(0,1.5,0.25)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title)) + xlab("5 days") + ylab("Depth level")
}
CHL_heat_map(bats[bats$year==1992,6:23], 1992)
CHL_heat_map(bats[bats$year==2000,6:23], 1992)
min(bats[,6:23])
max(bats[,6:23])
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
#return(plot_data)
return(ggplot(plot_data, aes(x=plot_data$`5days`, y=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(-1.8,0.4,0.25)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title)) + xlab("5 days") + ylab("Depth level")
}
CHL_heat_map(bats[bats$year==2000,6:23], 1992)
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
#return(plot_data)
return(ggplot(plot_data, aes(x=plot_data$`5days`, y=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(-1.8,0.4,0.2)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title)) + xlab("5 days") + ylab("Depth level")
}
CHL_heat_map(bats[bats$year==2000,6:23], 1992)
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
#return(plot_data)
return(ggplot(plot_data, aes(x=plot_data$`5days`, y=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(-1.8,0.4,0.4)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title)) + xlab("5 days") + ylab("Depth level")
}
CHL_heat_map(bats[bats$year==2000,6:23], 1992)
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
#return(plot_data)
return(ggplot(plot_data, aes(x=plot_data$`5days`, y=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-2,0.4), breaks=seq(-2,0.4,0.4)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title)) + xlab("5 days") + ylab("Depth level")
}
CHL_heat_map(bats[bats$year==2000,6:23], 1992)
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
#return(plot_data)
return(ggplot(plot_data, aes(x=plot_data$`5days`, y=plot_data$depth, fill=plot_data$CHL)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(-1.8,0.4,0.4)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title)) + xlab("5 days") + ylab("Depth level")
}
CHL_heat_map(bats[bats$year==2000,6:23], 1992)
?ggplot
?aes
CHL_heat_map <- function(CHL_data, year_title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
`5 days` <- plot_data$`5days`
`Depth level` <- plot_data$depth
`log10(CHL)` <- plot_data$CHL
return(ggplot(plot_data, aes(x=`5 days`, y=`Depth level`, fill=`log10(CHL)`)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(-1.8,0.4,0.4)) + scale_y_reverse() + coord_fixed() + ggtitle(year_title)) + xlab("5 days") + ylab("Depth level")
}
CHL_heat_map(bats[bats$year==2000,6:23], 1992)
CHL_heat_map(bats[bats$year==1992,6:23], 1992)
CHL_heat_map <- function(CHL_data, title) {
plot_data <- expand.grid(depth=1:18, `5days`=1:73)
plot_data$CHL <- c(sapply(1:nrow(CHL_data), function(row) as.numeric(CHL_data[row,])))
`5 days` <- plot_data$`5days`
`Depth level` <- plot_data$depth
`log10(CHL)` <- plot_data$CHL
return(ggplot(plot_data, aes(x=`5 days`, y=`Depth level`, fill=`log10(CHL)`)) + geom_tile() + scale_fill_gradientn(colors = rainbow(7), limits=c(-1.8,0.4), breaks=seq(-1.8,0.4,0.4)) + scale_y_reverse() + coord_fixed() + ggtitle(title))
}
CHL_heat_map(bats[bats$year==1992,6:23], "1992 sample")
